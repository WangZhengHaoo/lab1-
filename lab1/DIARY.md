# Дневник разработки веб-приложения "Интернет-Магазин"
Главная цель: Разработать простое веб-приложение -- интернет-магазин "Аптека-Лайн".

## TO-DO
* (Требование) Написать RestAPI CRUD-контроллеры для каждой главной сущности
* (Требование) Покрыть тестами каждый контроллер через testcontainers и jupiter
* (Требование) Приложение должно запускаться в докере через docker-compose
* (Требование) Должна быть авторизация с уникальными действиями для каждой роли
* (Требование) Каждый findAll должен иметь пагинацию
* (Требование) Должен быть минимум один запрос, который вернет findAll в виде бесконечной прокрутки без указания общего количества записей
* (Требование) Должен быть минимум один запрос, который вернет findAll с пагинацией и с указанием общего количества записей в http хедере
* (Требование) На сложных запросах должны использоваться транзакции. Должно быть не меньше двух подобных запросов. Обосновать почему там нужны тразакции

Каким оно должно быть?
Это простой многостраничник с авторизацией (без регистрации). Новых пользователей может создавать только супервайзер.
Есть каталог продукции, можно оформлять заказы, просматривать историю заказов, создавать\удалять пользователей.
Есть три типа пользователей (три роли):
1. Супервайзер. Доступна вся функциональность. Только он может добавлять и удалять пользователей.
2. Поставщик. Может только изменять каталог продукции.
3. Покупатель. Может просматривать каталог, оформлять заказы, просматривать историю заказов.

Интернет-магазин продаёт лекарства и рецепты.
Рецепт состоит из n-ного кол-ва определённых лекарств (или продуктов).
Каталог и витрина это одно и то же.
Каталог состоит из n позиций.
Позиция это выставленный на витрину рецепт.
Позиции формируются Поставщиком, он может выставлять на витрину новые позиции и снимать старые.

Диаграмма главных сущностей:
classDiagram

Order "*" --> "*" Position
Position "*" --> "1" Recipe
Recipe "*" <--> "*" Product  
Role "*" <--> "1" User

Главные задачи:
* Модель code-first с liquibase.
    Done. Сначала пишу все нужные entity-классы, затем запускаю 
      ``mvn liquibase:generateChangeLog``
    Только предварительно заменяю yaml файл с журналом изменений на новый в pom.xml чтобы старый не перетёрся.
    Или может не надо? Всё и так будет работать?
* Контроллеры с тестами, транзакциями, пагинацией.
    Так, может тут лучше сгенерировать crud-контроллер через openApi?
    Долго писать свои...
* Авторизация с ролями и JWT
    DONE. Ужас, ушёл весь день чисто на эту хрень...
* Докер

Задачи разбиваю по веткам-фичам.

7.9. 10:14.
Теперь надо писать crud-контроллеры. Деление по ролям такое:
* Супервайзер имеет доступ ко всему
* Поставщик имеет доступ только к методам из Position, Recipe, Product
* Покупатель может только создавать и просматривать Orders

До конца осталось 1 день 8 часов.

Сначала пишу спецификацию OpenAPI, по ней генерирую контроллеры. Хотя нафиг этот опенапи, двойная работа.
Сначала надо создать Entity.

13:23
    Создал все entity, сгенерил changelog. Теперь омжно писать контроллеры.
    
8.9. 14:08
Надо поправить роли у эндпоинтов, ещё:
* Создать 2 сложных эндпоинта с транзакциями
* Написать 2 findAll с пагинацией
* Покарыть тестами каждый контроллер через testcontainer
* Создать docker-image, запустить через docker-compose
